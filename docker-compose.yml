version: '3.8'

services:
  gemini-proxy:
    build: .
    ports:
      - "${SERVER_PORT:-8080}:${SERVER_PORT:-8080}"
    env_file:
      - .env
    environment:
      # Set ASYNC_MODE=true to enable async mode (recommended for production)
      # Set ASYNC_MODE=false or omit for sync mode (default)
      - ASYNC_MODE=${ASYNC_MODE:-false}
    restart: unless-stopped
    volumes:
       - ./:/app/
       # To grant the container access to the host's Docker daemon, we mount the Docker socket.
       # The path /var/run/docker.sock is standard for Linux.
       # Docker Desktop for macOS and Windows creates a Linux VM to run containers,
       # and it makes the Docker socket available at the same path inside that VM.
       # Therefore, this configuration is cross-platform for Linux, macOS, and Windows (with Docker Desktop).
       - /var/run/docker.sock:/var/run/docker.sock
